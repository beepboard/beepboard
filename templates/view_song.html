{% extends "base.html" %}

{% block title %} song {{song.name}} {% endblock %}

{% block head %}
	<link rel="stylesheet" href="/styles/view-song.css">
{% endblock %}

{% block main %}
<article>
	{% if song %}
		<div class="viewsong">
			<div class="head">
				<div class="title">
					<a href="/Song/{{song.id}}/play">
						<img class="mod" src="/assets/mods/{{song.content.url.mod}}.png">
					</a>
					<h2>{{song.content.name}}
						<br>
						<small>
							by <em>{{song.author.username}}</em> ·
						    {{song.created.date}} ·
						    song #{{song.id}}
						</small>
					</h2>
				</div>
			</div>
			
			<div class="bio">
				{{ song.content.desc.html | safe}}
			</div>
			
			<div class="stats">
				<div class="stat">
					<img class="icon"     src="/assets/likes.png">
					{% if myself and not has_interacted %}
						<a href="/Song/{{song.id}}/upvote">
							<img class="interact" src="/assets/upvote.png">
						</a>
					{% else %}
						<a href="/Song/{{song.id}}/downvote">
							<img class="interact" src="/assets/downvote.png">
						</a>
					{% endif %}
					<p>{{song.stats.likes}}</p>
				</div>
				<div class="stat">
					<img class="icon"     src="/assets/clicks.png">
					<p>{{song.stats.clicks}}</p>
				</div>
				<div class="stat">
					<img class="icon"     src="/assets/views.png">
					<p>{{song.stats.views}}</p>
				</div>
			</div>
			
			<h2>Comments</h2>
			
			<div class="comments">
				{% for comment in song.comments recursive %}
					<div class="comment">
						<img class="pfp" src="{{comment.user.profile.pfp}}">
						<div class="content">
							<div class="info">
								<p class="poster">
									{{comment.user.username}}
								</p>
								<small class="misc">
									{{comment.created.date}} ·
									comment #{{comment.id}}
								</small>
							</div>
							<p class="text">
								{{comment.content}}
							</p>
						</div>
					</div>
					
					<div class="replies">
						<div class="comments">
							{{ loop(comment.replies) }}
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	{% else %}
		<p>Song not found.</p>
	{% endif %}
</article>
{% endblock %}