{% extends "base.html" %}

{% block head %}
	<link rel="stylesheet" href="/styles/view-user.css">
	<link rel="stylesheet" href="/styles/badges.css">
	<link rel="stylesheet" href="/styles/songs.css">
{% endblock %}

{% block title %} user {{user.username}} {% endblock %}

{% block main %}
<article>
	{% if user %}
		<div class="viewuser">
			<div class="head">
				<img class="pfp" src="{{ user.profile.pfp.url }}">
				<div class="desc">
					<h2>
						{{ user.username }}
						{% for badge in user.badges | sort %}<img class="badge {{badge}}"
						                                          title="{{BADGES[badge].name}} ({{BADGES[badge].desc}})"
						                                          src="/assets/trans.png">{% endfor %}
						<br>
						<small>{{ user.created.date }} · user #{{user.id}}</small>
					</h2>
					
					
					{% if myself %}
						<div class="actions">
							{% if myself.id == user.id %}
								<a title="edit"   href="/Profile/edit" class="action">
									<img class="edit" src="/assets/trans.png">
								</a>
							{% else %}
								<a title="report" href="/User/{{user.id}}/report" class="action">
									<img class="report" src="/assets/report.png">
								</a>
							{% endif %}
						</div>
					{% endif %}
				</div>
			</div>
			
			<div class="bio">
				{{ user.profile.bio.html | safe}}
			</div>
			
			<h2>
				Songs
				{% if myself.id == user.id %}
					<a title="upload a song" href="/Song/submit"><img class="submit" src="/assets/trans.png"></a>
				{% endif %}
			</h2>
			<div class="songs">
				{% for song in songs %}
					<div class="song">
						<div class="left">
							{% if myself.id == user.id %}
								<a class="delete" href="/api/v1/Song/{{song.id}}/delete" onclick="return confirm('Are you sure you want to delete song \'{{song.content.name}}\' (id {{song.id}})?')">
									<img src="/assets/trans.png">
								</a>
							{% endif %}
							<a target=_blank href="/Song/{{song.id}}/play">
								<img class="mod" src="/assets/mods/{{song.content.url.mod}}.png"></img>
							</a>
							<div class="meta">
								<p class="name">
									<a href="/Song/{{song.id}}">{{ song.content.name }}</a>
								</p>
								<div class="songtags">
									{% if song.content.tags %}
										{{ ' · '.join(song.content.tags.split(','))[3:-2] }}
									{% else %}
										(no tags)
									{% endif %}
									&nbsp;
								</div>
							</div>
						</div>
						<div class="right">
							<p class="author">
								 by <a href="/User/{{user.id}}">{{ user.username }}</a>
							</p>
							<small>
								{{ song.created.date }}
								· {{ song.stats.likes  }} likes
								· {{ song.stats.clicks }} clicks
								· {{ song.stats.views  }} views
							</small>
						</div>
					</div>
				{% else %}
					{% if myself.id == user.id %}
						<p><em>no songs found ¯\_(ツ)_/¯ · try <a href="/Song/submit">uploading</a> some songs!</em></p>
					{% else %}
						<p><em>no songs found ¯\_(ツ)_/¯</em></p>
					{% endif %}
				{% endfor %}
			</div>
		</div>
	{% else %}
		<p>User not found.</p>
	{% endif %}
</article>
{% endblock %}